import { Link } from '@nextui-org/react'

<CodeWithAccoridions>
## !!accordions Section 1: Setup and initialize a new React project with NextUI

Before we dive into coding the profile page, let's set up our project:

1.  **Prerequisites:** Ensure you have Node.js and yarn (or npm) installed on your machine.
2.  **NextUI CLI:** Open your terminal and run the following command to install the NextUI CLI globally, execute the following command in your terminal:

```bash
yarn add nextui-cli -g
```

3.  **Init a new NextUI project :** Initialize a new NextUI project using the init command. This sets up your project with the necessary configurations:

```bash
nextui init my-nextui-app
```

You will be prompted to configure your project:

```bash
? Which components would you like to add? › - Space to select. Return to submit

Instructions:
    ↑/↓: Highlight option
    ←/→/[space]: Toggle selection
    [a,b,c]/delete: Filter choices
    enter/return: Complete answer

Filtered results for: Enter something to filter
    ◯  accordion
    ◯  autocomplete
    ◯  avatar
    ◯  badge
    ◯  breadcrumbs◉  button
    ◯  card
    ◯  checkbox
    ◯  chip
    ◯  code
```

You can just use the default configuration and add all the components for now.

4.  **Start Development Server:** Install the dependencies to start the local server:

```bash
cd my-nextui-app && yarn install
```

```bash
yarn dev
```

You should now have a NextUI startup screen at `http://localhost:3000/` in your browser, ready for us to transform into a stunning profile page!

## !!accordions Section 2: Building the FeaturePhotos component

In this section, we'll craft a captivating header showcasing a rotating carousel of feature photos using NextUI for styling, Embla Carousel React for the core carousel functionality, and Tailwind CSS for additional customization.

1. Files and Structure:

   - `feature-photos.tsx`: The main component file for the FeaturePhotos component.
   - `carousel-dot-buttons.tsx`: A component for rendering navigation dots in the carousel.
   - `constants.ts`: A file containing constants for styling.
   - `types.ts`: TypeScript file for defining the component's prop types.

2. Dependencies:

   - `embla-carousel-react`: A lightweight carousel library for React. Install it using `yarn add embla-carousel-react`.
   - `@nextui-org/react`: NextUI components for building the UI

3. Deep dive into `feature-photo.tsx` file:

   - **Props:**

     - `photos`: An array of photo URLs to display in the carousel.
     - `showDots`: A boolean to toggle the visibility of navigation dots.

   - **Carousel Setup:**

     - `useEmblaCarousel` to control the carousel. It's a handy hook provided from `embla-carousel-react` giving us a `ref` to attach to our wrapping element, which is needed to cover the scroll overflow
     - `useDotButton` to manage the state of the navigation dots. It provides the selected index, an array of scroll snap points, and a function to handle dot button clicks.
     - `<CarouselDotButton/>` is a custom component that renders a dot button for each photo. It receives an `onClick` function to handle the click event and a `className` to style the button based on its active state.
     - We will break down the `CarouselDotButton` component and `useDotButton` hook later.

   - **Handling Navigation Dot Button Clicks:**

     - `handleDotButtonClick` is a function that takes an index and returns another function. This returned function, when called, triggers the `onDotButtonClick` function with the provided index.

     ```tsx
     const handleDotButtonClick = (index: number) => {
       // !mark(1:3)
       return () => {
         onDotButtonClick(index)
       }
     }
    
      <CarouselDotButton
       ...
       // !mark(1:1)
       onClick={handleDotButtonClick(index)}
       ...
     />
     ```

     - This pattern is known as a <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Closures" target="_blank">closure</a>, allowing each dot button to have its own specific behavior when clicked.

   - **Rendering:**

     - The component returns a `<section>` element with two main parts:
       - A block containing the carousel. Photos are mapped elements containing an `<Image>` component from '@nextui-org/react' for each photo. Each image's height is set to `FEATURE_HEADER_HEIGHT` pixels, and the width is set to fill the screen.
       - A conditional block that renders navigation dots using `<CarouselDotButton/>` if `showDots` to visually indicate the currently selected dot.

   - **Styling:**
     - The carousel and its elements are styled using Tailwind CSS classes for layout and appearance. The `className` properties dynamically apply styles based on the component's state and props, such as adjusting the opacity of the active dot.
     - We use the `cn` utility class from NextUI to conditionally apply classes based on the active state of the dot. This util function is also used to join `classNames` together avoiding the TailwindCSS classes conflicts.
     ```tsx
     <CarouselDotButton
        ...
        className={cn(
           'inline-flex cursor-pointer border-0 p-0 m-0 size-2 ...',
           {
              // !callout[/bg-gray-300 opacity-100/] These classnames will only be applied for the active dot element
              'bg-gray-300 opacity-100': index === selectedIndex,
           }
        )}
     />
     ```

4. Deep dive into `carousel-dot-buttons.tsx` file: <br/>

   - **`useDotButton` hook:**

     - The main purpose of this hook is to manage the state of the navigation dots in the carousel. It takes `emblaApi` as an argument, which is the carousel API needed for interacting with the carousel.
     - It has an effect that listens to the `reInit` and `select` from embla carousel API to update the selected index.
     ```tsx
      React.useEffect(() => {
         if (!emblaApi) return;

         onInit(emblaApi);
         onSelect(emblaApi);
         // !mark(1:1)
         emblaApi.on('reInit', onInit).on('reInit', onSelect).on('select', onSelect);
      }, [emblaApi, onInit, onSelect]);
     ```
     - The `onDotButtonClick` function execute the `scrollTo` method from the embla carousel API to scroll to the selected photo.
     - The `scrollSnaps` array contains the scroll snap points for each photo in the carousel.
     - The `selectedIndex` variable holds the index of the currently selected photo.
     - The `useDotButton` hook returns an object with the selected index, scroll snaps, and a function to handle dot button clicks. So we can use this object in the `FeaturePhotos` component.

   - **`CarouselDotButton` component:**
     - This component is just a wrapper of the native html button element. It takes all the props that a button element can take, so we can style the button based on its active state and handle the click event from the `FeaturePhotos` component.

**Live Demo:** <br/>
We've created a Storybook story for the `FeaturePhotos` component to showcase its functionality and appearance. You can check it out here: <a href="https://66a1ae67d3806ba8755e9ebe-rktxlyjzkm.chromatic.com/?path=/docs/tutorials-profile-ui-components-feature-photos--docs" target="_blank">FeaturePhotos Story</a>

Now that we've built the `FeaturePhotos` component, we can move on to the next section of our profile page.

## !!accordions Section 3: Designing the Profile Information Section

In this section, we'll create the ProfileInfo component which is responsible for displaying the main information section of a user's profile page.<br/>

1. Files and Structure:

   - `profile-info.tsx`: The main component file for the ProfileInfo component.
   - `info-line.tsx`: A reusable component for displaying an icon and text in a row.
   - `typography.tsx`: Custom typography components for consistent text styling.
   - `utils.ts`: Utility functions for generating avatar fallback text and formatting the user's location.
   - `types.ts`: TypeScript file for defining the component's prop types.

2. Dependencies:
   - `@nextui-org/react`: NextUI components for building the UI
   - `lucide-react`: A library of simply beautiful open-source icons. Install it using `yarn add lucide-react`.

3. Deep dive into `profile-info.tsx` file:
   - **Props:**

     - `profile`: An object containing the user's information like name, username, title, bio, location, website, and avatar URL.
     - `company`: An object containing the company's information like name and website.

   - **Rendering:**

     - The component returns a `<section>` element with the user's avatar, name, username, title, bio, location, website, and an edit profile button.
     - The user's avatar is displayed using the `Avatar` component from '@nextui-org/react'. If the avatar URL is not provided, a fallback text generated from the user's name is displayed.
     - The user's company name is displayed as a clickable link to their website using the `Link` component from '@nextui-org/react'.
     - The user's location and website are displayed using the `InfoLine` component, which shows an icon and text in a row.

4. Deep dive into `info-line.tsx` and `typography.tsx` files:
      - This component takes an icon, classname, and children as props to display an icon and content in a row.
      - We're using the `Icon` component from '@nextui-org/react' to render the icon and `Spacer` component for spacing between the icon and content.
      - The `Paragraph` and `Subtle` components are custom typography components for consistent text styling across the profile page.

**Live Demo:** <br/>
We've created a Storybook story for the `ProfileInfo` component to showcase its functionality and appearance. You can check it out here: <a href="https://66a1ae67d3806ba8755e9ebe-rktxlyjzkm.chromatic.com/?path=/docs/tutorials-profile-ui-components-profile-info--docs" target="_blank">ProfileInfo Story</a>

So far, we've created the `FeaturePhotos` and `ProfileInfo` components. Next, we'll implement the Profile Stats section.

## !!accordions Section 4: Creating the Profile Stats Section

In this section, we'll build the ProfileStats component, which displays the user's profile statistics like followers, following, and posts count.<br/>
Since it's a pretty straightforward component, let's dive into the implementation by opening the `profile-stats.tsx` tab:

1. Files and Structure:

   - `profile-stats.tsx`: The main component file for the ProfileStats component.
   - `stats-block.tsx`: A reusable component for displaying a label and value in a column.
   - `utils.ts`: Utility functions for formatting numbers.
   - `types.ts`: TypeScript file for defining the component's prop types.

2. Deep dive into `profile-stats.tsx` file:
   - **Props:**
     - `stats`: An object containing the user's statistics like followers, following, and posts count.

   - **Rendering:**
     - The component returns a `<section>` element with three `StatsBlock` components for displaying followers, following, and posts count.
     - The `StatsBlock` component takes a label and value as props and displays them in a column.
     - The numbers are formatted using the `formatNumber` utility function to include commas and a maximum of 3 decimal places.

**Live Demo:** <br/>
We've created a Storybook story for the `ProfileStats` component to showcase its functionality and appearance. You can check it out here: <a href="https://66a1ae67d3806ba8755e9ebe-rktxlyjzkm.chromatic.com/?path=/docs/tutorials-profile-ui-components-profile-stats--docs" target="_blank">ProfileStats Story</a>

## !!accordions Section 5: Implementing the Profile Timeline Tabs

In this section, we'll create the ProfileTimeline tab component, which allows users to switch between different timeline views like posts, photos, and liked posts.

{/* 1. Files and Structure:
  
   - `profile-timeline.tsx`: The main component file for the ProfileTimeline component.
   - `use-timeline-tabs.tsx`: A custom hook for creating tab data.
   - `post-card.tsx`: A component to display a post card.
   - `post-card.utils.tsx`: Utility functions for handling post card's content and actions.
   - `use-profile.ts`: A sample hook for fetching current user profile data.
   - `posts.tsx`: A component to display a list of posts.
   - `photo-card.tsx`: A component to display a photo card.
   - `photos.tsx`: A component to display a list of photos.
   - `utils.ts`: Utility functions for formatting dates.
   - `types.ts`: TypeScript file for defining the component's prop types and related interfaces.

2. Dependencies:
   - `@nextui-org/react`: NextUI components for building the UI
   - `lucide-react`: A library of popular icons for React. Install it using `yarn add lucide-react`.
   - `react-markdown`: A library for rendering Markdown content in React. Install it using `yarn add react-markdown`.
   - `remark-gfm`: A plugin for parsing GitHub Flavored Markdown. Install it using `yarn add remark-gfm`. */}

1. Build the Posts component:
   - **Files and Structure:**
     - `post-card.tsx`: A component to display a post card.
     - `post-card.utils.tsx`: Utility functions for rendering post's actions such as like, comment, share buttons...
     - `posts.tsx`: The main component file for rendering a list of posts.
     - `types.ts`: TypeScript file for defining the component's prop types and related interfaces.

	- **Deep dive into `post-card.tsx` file:**
		- **Props:**
			- `createdAt`: The date and time when the post was created.
			- `content`: The content of the post.
			- `authorName`: The name of the author of the post.
			- `authorUsername`: The username of the author.
			- `avatar`: The URL of the author's avatar image.
			- `isSelfPost`: A boolean indicating if the post is created by the current user.
			- `postActionConfig`: Configuration for actions that can be performed on the post.
			- `postMenuActionConfig`: Configuration for actions available in the post's menu.
			- `className`: Additional CSS classes for styling.
			- `...rest`: Any other `Card` props that are passed to the component.

		- **Functions:**
			- `getPostActions()`: This function is called to get the actions that can be performed on the post.
			- `getPostMenuActions({ isSelfPost })`: This function is called to get the actions available in the post's menu, considering if the post is created by the current user.
			- These 2 functions are defined in the `post-card.utils.tsx` file. We will explore them later.
		- **Event handlers:**
			- `handleOnMenuDropdownAction(type: PostMenuActionType)`: This function handles menu dropdown actions based on the action type.
			- `handleOnPostAction(type: PostActionType)`: This function handles post actions based on the action type.
		
		- **Rendering:**
			- The component returns a `Card` component that wraps the entire post.
			- Inside the `Card`, there is a `CardHeader` that contains:
				- A `User` component displaying the author's name, username (as a link), and avatar.
				- A `Subtle` component showing the formatted creation date.
			- If `postMenuActionConfig` is provided, a `Dropdown` component is rendered:
				- The `Dropdown` contains a `DropdownTrigger` with a button to open the menu.
				- The `DropdownMenu` contains `DropdownItem` components for each action in `postMenuActions`.
			- The `CardBody` contains the post content using `MarkdownRenderer` component to render markdown content.
			- If `postActionConfig` is provided, a `CardFooter` component is rendered:
				- The `CardFooter` contains `Button` components for each action in `postActions`.
   
   - **Deep dive into `post-card.utils.tsx` file:** <br/> <br/>
      In this file, we define utility functions for rendering post actions and post menu actions. We have 3 main functions:
      - `getPostActions()`: This function returns an array of post actions based on the `postActionConfig` provided to the `PostCard` component.
      - `getPostMenuActions({ isSelfPost })`: This function returns an array of post menu actions based on the `postMenuActionConfig` provided to the `PostCard` component. The `isSelfPost` parameter is used to determine if the post is created by the current user.
      - `getPostActionCount(type, config)`: This function returns the content for a specific post action such as like counts, comment counts, and repost counts. The `type` parameter specifies the action type, and the `config` parameter contains the action configuration.
   
   - **Deep dive into `posts.tsx` file:** <br/> <br/>
      In this file, we define the `Posts` component that renders a list of posts. The component takes an array of post objects as a prop and maps over them to render individual `PostCard` components.


{/* 6. Deep dive into `profile-timeline.tsx` file:
   - **Props:**
     - `posts`: An array of post objects containing the post content, date, and likes.
     - `photos`: An array of photo objects containing the photo URL and date.
     - `likedPosts`: An array of liked post objects containing the post content, date, and likes.

   - **Rendering:**
     - The component returns a `<section>` element with a `Tabs` component from '@nextui-org/react' for switching between different timeline views.
     - The `Tabs` component uses the `useTimelineTabs` hook to generate tab data for posts, photos, and liked posts. We will explore this hook later in the next discussion.
     ```tsx
      const tabs = useTimelineTabs({ likedPosts, photos, posts });
     ```
     - `tabs` is an array of tab objects containing the tab label, content, and unique ID. It will be passed to the `Tabs` component as the `items` prop.
     - The `Tabs` component support <a href="https://legacy.reactjs.org/docs/render-props.html" target="_blank">Render Props</a> technique to render the tab contents based on the data passed via the `items` prop.
     ```tsx
      <Tabs
         aria-label="Profile timeline"
         color="primary"
         fullWidth
         variant="underlined"
         // !mark(1:1)
         items={tabs}
         destroyInactiveTabPanel={false}
         classNames={{
            base: 'sticky top-0 z-50 bg-background',
         }}
         >
         {(item) => (
         // !mark(1:3)
            <Tab key={item.id} title={item.label}>
               <div className="px-2">{item.content}</div>
            </Tab>
         )}
      </Tabs>
     ``` */}



</CodeWithAccoridions>


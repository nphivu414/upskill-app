import { Link } from '@nextui-org/react'
import { CollapsibleBlock } from '../../collapsible-block.tsx'
import { CodeTabTrigger } from '../../code-tab-trigger.tsx'

import {
   steps
} from '../step-config.tsx'

export const section = 'flight-header'

<CodeWithAccoridions stepConfigs={steps}>
## !!accordions Section 1: Setup and initialize a new React project with NextUI

Before we dive into coding the profile page, let's set up our project:

1.  **Prerequisites:** Ensure you have Node.js, yarn (or npm) and git installed on your machine.
2.  **Clone our starter repo:** Open your terminal and run the following command to clone the starter repository:

```bash
git clone https://github.com/upskillsdev/starter-app.git
```

3.  **Start Development Server:** Install the dependencies to start the local server:

```bash
cd starter-app && yarn install
```

```bash
yarn dev
```

You should have a startup screen at `http://localhost:5173/` in your browser.
Now you can now head over to the `src/pages/index.tsx` file and start building the search flight page.

## !!accordions Section 2: Building Flight Header Component

In this section, we will build the flight header component that displays the flight details and allows users to perform actions like going back and sharing the flight details.
The component will also support sticky behavior and hide on scroll so that it doesn't take up too much space on the screen.

1. Files and Structure:
   - <CodeTabTrigger section={section} tab="flight-header.tsx"/>: This file contains the flight header component.
   - <CodeTabTrigger section={section} tab="use-hide-on-scroll-header.ts"/>: A custom hook for hiding the header on scroll.
   - <CodeTabTrigger section={section} tab="typography.tsx"/>: This file contains the typography components for the flight header.
   - <CodeTabTrigger section={section} tab="utils.ts"/>: Utility functions for formatting dates.
   - <CodeTabTrigger section={section} tab="constants.ts"/>: This file contains the constants for the flight header component like height and animation duration.
   - <CodeTabTrigger section={section} tab="types.ts"/>: This file contains the types for the flight header component. Types defined separetely here to be reused in other components later on.

2. New dependencies:
   - `lucide-react`: A library of simply beautiful open-source icons. Install it using `yarn add lucide-react`.

3. Deep dive into <CodeTabTrigger section={section} tab="flight-header.tsx">flight-header.tsx</CodeTabTrigger> file:
   - **Props:** The component accepts the following props:
     - `from`: The departure city.
     - `to`: The arrival city.
     - `departureDate`: The departure date.
     - `returnDate`: The return date.
     - `cabinClass`: The cabin class.
     - `handleBack`: A function to handle the back action.
     - `handleShare`: A function to handle the share action.
     - `sticky`: A boolean to make the header sticky.
     - `shouldHideOnScroll`: A boolean to hide the header on scroll.
     - `parentScrollY`: A motion value to track the scroll position.
   - **Rendering:**  The component layout is divided into 3 columns:
     - **Back Button:** A button to go back to the previous page.
     - **Flight Details:** The flight details like departure city, arrival city, departure date, return date, and cabin class.
     - **Share Button:** A button to share the flight details.
   - **Sticky Header:** A whole component is wrapped in a `motion.div` to enable hide/show animations. We created a custom hook called `useHideOnScrollHeader` to return the `props` needed for the animation.
   ```tsx
      // !mark(1:1)
      const motionsProps = useHideOnScrollHeader(parentScrollY, shouldHideOnScroll);
      return (
         <motion.div
            // !mark(1:1)
            {...motionsProps}
         >
            ...
         </motion.div>
   ```

4. Deep dive into <CodeTabTrigger section={section} tab="use-hide-on-scroll-header.ts">use-hide-on-scroll-header.ts</CodeTabTrigger> file:
   - **Custom Hook:** This hook is responsible for hiding the header on scroll. It takes the parent scroll position and the hide on scroll flag as arguments.
   - **State and Ref Initialization:**
      - `showHeader`: State to track if the header is visible.
      - `lastScrollYRef`: Ref to store the last scroll position.
   - **Effect Hook:**
      - We use `useEffect` to subscribes to changes in `parentScrollY` if `parentScrollY` and `shouldHideOnScroll` are provided.
      - **Conditions to Hide Header**: If the current scroll position (latest) is **greater than** the last scroll position **plus the threshold** (thresshold), hide the header. We use a threshold to avoid flickering due to small scroll changes.
      - **Conditions to Show Header**: If the current scroll position is **less than** the last scroll position **minus the threshold**, show the header. If the current scroll position is less than or equal to 0 (top of the page), show the header.

Now that we have a good understanding of the setup and the flight header component, let's start building the next component: the `<FlightCard/>`.

## !!accordions Section 3: Building Flight Card Component

In this section, we will build the flight card component that displays the flight details like airline name, cabin class, aircraft type, and logo.
The card will also show the flight timeline, fare details, and benefits like meals, entertainment, etc. The component will be reusable and flexible to accommodate different flight details.

1. Files and Structure:
   - <CodeTabTrigger section="flight-card" tab="flight-overview.tsx"/>: A component that shows overview info as a header of the flight card.
   - <CodeTabTrigger section="flight-card" tab="flight-timeline.tsx"/>: A component that shows the timeline of the flight including departure, arrival, stops, and duration.
   - <CodeTabTrigger section="flight-card" tab="flight-fare-details.tsx"/>: A component that shows the fare details of the flight.
   - <CodeTabTrigger section="flight-card" tab="airline-logo.tsx"/>: A component that displays the airline logo.
   - <CodeTabTrigger section="flight-card" tab="flight-benefits.tsx"/>: A component that displays the benefits of the flight like meals, entertainment, etc.
   - <CodeTabTrigger section="flight-card" tab="flight-card.tsx"/>: The main component that put all the above components together to render the flight card.
   - <CodeTabTrigger section="flight-card" tab="utils.ts"/>: Utility functions for getting the right benefit icons.
   - <CodeTabTrigger section="flight-card" tab="constants.ts"/>: This file contains the constants for flight cabin class mapping.
   - <CodeTabTrigger section="flight-card" tab="types.ts"/>: This file contains the types for the flight card component. Types defined separetely here to be reused in other components later on.

2. Deep dive into <CodeTabTrigger section="flight-card" tab="flight-overview.tsx"/> file:
   - **Props:** The component accepts the following props:
     - `airline`: The airline details.
     - `cabinClass`: The cabin class.
     - `aircraftType`: The aircraft type.
   - **Rendering:** The component play a role as a header of the flight card. We use flexbox to build the layout, the `<Subtle>` component style the text to be subtle, and `<AirlineLogo>` component to display the airline logo.

3. Deep dive into <CodeTabTrigger section="flight-card" tab="flight-timeline.tsx"/> file:
   - **Props:** The component accepts the following props:
      - `departureTime`: The departure time.
      - `arrivalTime`: The arrival time.
      - `duration`: The flight duration.
      - `departureAirport`: The departure airport.
      - `arrivalAirport`: The arrival airport.
      - `totalStops`: The total stops.
   - **Rendering:** The component displays the timeline of the flight including departure, arrival, stops, and duration. We use the `<Subtle>` component to style the text to be subtle.
      - We use the `Slider` component from `@nextui-org/react` with a custom style to display the timeline. It shows departure time and airport on the start and arrival time and airport on the end.
      - Flight duration will be displayed above the timeline.
      - Total stops will be displayed below the timeline.

4. Deep dive into <CodeTabTrigger section="flight-card" tab="flight-fare-details.tsx"/> file:
   - **Props:** The component accepts the following props:
      - `price`: The price of the flight.
      - `isRoundTrip`: A boolean to indicate if the flight is round trip.
   - **Rendering:**
      - The price will be formatted to display the currency symbol and the price using the <CodeTabTrigger section="flight-card" tab="utils.ts">`formatNumber`</CodeTabTrigger> utility function.
      - If the flight is round trip, we use `Chip` component from `@nextui-org/react` to display a round trip badge.

5. Deep dive into <CodeTabTrigger section="flight-card" tab="airline-logo.tsx"/> file:
   - **Props:** The component accepts all the props from `Avatar` component from `@nextui-org/react`.
   - **Rendering:** We add a default size `sm` and a skeleton fallback so that the UI doesn't break if the airline image is not loaded.

6. Deep dive into <CodeTabTrigger section="flight-card" tab="flight-benefits.tsx"/> file:
   - **Props:** The component accepts the following props:
      - `benefits`: An array of benefits like meals, entertainment, etc.
   - **Rendering:** The component displays the benefits of the flight like meals, entertainment, etc. We use the `Chip` component from `@nextui-org/react` with a custom `startContent` to display the benefit icon before the benefit name.
      - We create the <CodeTabTrigger section="flight-card" tab="utils.ts">`getBenefitIcon`</CodeTabTrigger> utility function to get the right icon for each benefit based on the name.

7. Deep dive into <CodeTabTrigger section="flight-card" tab="flight-card.tsx"/> file:
   - Now that we've covered all the sub-components, let's put them all together in the main `FlightCard` component.
   - **Props:** The component literally accepts all the data needed to render other sub-components.
   - **Rendering:** We use the `<Card>` component from `@nextui-org/react` to wrap the flight card. Inside the card, `FlightOverview` will be rendered as the Card Header, `FlightTimeline` and `FlightFareDetails` will be rendered as the Card Body, and `FlightBenefits` will be rendered as the Card Footer.

Now that we've completed building the flight card component, we can move on to the next section: building the `<FlightList/>` component.

## !!accordions Section 4: Building Flight List Component
In this section, we will build the flight list component that displays a list of flight card that we've built in the previous section.

1. Files and Structure:
   - <CodeTabTrigger section="flight-list" tab="flight-list.tsx"/>: The main component that renders the list of flight cards.

2. Deep dive into <CodeTabTrigger section="flight-list" tab="flight-list.tsx"/> file:
   - **Props:** The component accepts the following props:
      - `data`: An array of flight data.
   - **Rendering:** The component will render the header with the search results and the number of flights. Below the header, we map through the flight data and render a `FlightCard` for each flight.
   ```tsx
      //!mark(4:9)
      return (
         <div>
            <div className="flex w-full flex-col gap-2 px-4 pb-4">
               {data.map((flight) => (
                  <FlightCard
                     key={flight.id}
                     onPress={handleFlightCardPress}
                     {...flight}
                  />
               ))}
            </div>
         </div>
      );
   ```
   - **Handle Card onPress:** We have a `handleFlightCardPress` function that you can use to handle the card press event. In realword scenario, you can use this function to navigate to the flight details page or show a modal with more details.
   ```tsx
      const handleFlightCardPress = (id: Flight['id']) => {
         // You can navigate to the flight details page
         router.push(`/flight-details/${id}`);
         // or show a selected flight modal with more details
         setSelectedFlight(id);
         showModal();
      };
   ```

</CodeWithAccoridions>
